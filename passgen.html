<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#0b0c10">
  <title>PassGen · idkwhy.top</title>
  <meta name="description" content="Ultra-light, zero-dependency, offline-ready password generator." />
  <style>
    :root{
      --bg:#0b0c10;--card:#12141b;--ink:#e7e9ee;--muted:#a3a6ad;--line:#262a36;--accent:#8ea0ff;--ok:#5eead4;--warn:#fbbf24;--bad:#f87171;--shadow:0 14px 48px rgba(0,0,0,.38);
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:
      radial-gradient(900px 500px at 70% -10%, rgba(154,166,255,.12), transparent 60%),
      radial-gradient(800px 400px at -10% 110%, rgba(94,234,212,.10), transparent 60%),
      var(--bg);
      color:var(--ink);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;
      min-height:100vh;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
      /* 背景固定在视口，不随内容滚动 */
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    /* 页面容器：负责顶对齐并居中卡片 */
    .page{min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:24px}
    .container{width:min(100%,860px);max-width:860px}
    /* 让 wrap 只是内容宽度容器（避免与 body 布局冲突） */
    .wrap{width:100%}

    .card{background:linear-gradient(180deg,rgba(18,20,27,.96),rgba(18,20,27,.86));border:1px solid #2a2e3a;border-radius:22px;padding:22px;box-shadow:var(--shadow)}
    header h1{margin:0 0 8px;font-weight:800;letter-spacing:-.02em}
    header h1 span{color:var(--accent)}
    header .sub{margin:0 0 18px;color:var(--muted)}

    .out{display:flex;gap:12px;align-items:center;position:relative}
    /* single-line password display with right space for action icons */
    .pwd{flex:1;font:700 20px/1.35 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:var(--ink);background:#0d0f14;border:1px solid var(--line);border-radius:14px;padding:18px 16px 18px 16px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:border-color .2s, box-shadow .2s}
    .out .pwd{padding-right:16px} /* room for two icon buttons */

    /* by default icons are inline (mobile-friendly); desktop will position them inside the pwd box */
    .btn.icon{display:inline-flex;align-items:center;justify-content:center;min-width:40px;height:40px;padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);box-shadow:none;transition:transform .14s ease, box-shadow .18s, background .18s, border-color .18s}
    .btn.icon svg{width:20px;height:20px;display:block}
    /* primary icon filled style */
    .btn.icon.primary{background:linear-gradient(180deg,#8ea0ff,#7382ff);color:#0b0c10;border-color:#7382ff;box-shadow:0 6px 14px rgba(142,160,255,.14)}
    /* subtle hover: small lift and slight scale */
    :root{--icon-hover-ty:-2px;--icon-hover-scale:1.01;--icon-active-scale:0.996}
    .btn.icon:hover{transform:translateY(var(--icon-hover-ty)) scale(var(--icon-hover-scale));box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .btn.icon:hover:not(.primary){background:rgba(142,160,255,0.03);border-color:rgba(142,160,255,0.12)}
    .btn.icon.primary:hover{box-shadow:0 10px 20px rgba(142,160,255,.16);transform:translateY(var(--icon-hover-ty)) scale(var(--icon-hover-scale))}
    /* active/pressed: unified, subtle depress */
    .btn.icon:active, .btn.icon.primary:active{transform:translateY(0) scale(var(--icon-active-scale));box-shadow:none;opacity:0.98}
    /* keyboard focus */
    .btn.icon:focus-visible{outline:3px solid rgba(142,160,255,0.14);outline-offset:2px}

    /* Desktop: place icons absolutely inside the password box */
    @media (min-width:641px){
      .out .pwd{padding-right:72px}
      .btn.icon{position:absolute;top:12px;right:12px}
      .btn.icon.primary{right:56px}
    }

    .pwd:focus{outline:none;border-color:#3a3f52;box-shadow:0 0 0 3px rgba(154,166,255,.18)}

    .btn{padding:12px 16px;border-radius:14px;border:1px solid var(--line);background:#111319;color:var(--ink);cursor:pointer;transition:transform .12s ease, box-shadow .2s, border-color .2s, background .2s}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn:focus{outline:none;box-shadow:0 0 0 3px rgba(154,166,255,.18)}
    .btn.primary{background:linear-gradient(180deg,#8ea0ff,#7382ff);color:#0b0c10;border-color:#7382ff;font-weight:800;box-shadow:0 10px 30px rgba(154,166,255,.25)}

    /* Toast: slide-in from off-screen top, then fade out */
    .toast{
      position:fixed;
      top:-120px;
      left:50%;
      transform:translateX(-50%);
      background:var(--ok);
      color:#0b0c10;
      padding:10px 14px;
      border-radius:10px;
      box-shadow:0 12px 36px rgba(0,0,0,0.45);
      font-weight:800;
      opacity:0;
      transition:transform .35s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
      z-index:9999;
      pointer-events:none;
      will-change:transform,opacity;
    }
    .toast.show{ transform:translateX(-50%) translateY(12px); top:12px; opacity:1 }
    .toast.hide{ opacity:0 }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
    .box{border:1px solid var(--line);border-radius:16px;padding:16px;background:linear-gradient(180deg,rgba(17,19,26,.9),rgba(17,19,26,.78))}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0}
    .row input[type="range"]{width:62%}
    .row label{display:flex;align-items:center;gap:10px}

    /* layout for range + value on same line */
    /* slider component */
    .slider-wrap{display:flex;align-items:center;gap:12px;width:100%}
    .slider-wrap input[type="range"]{flex:1}
    .slider-value{min-width:48px;text-align:center;color:var(--ink);font-weight:800;background:#0d0f14;border:1px solid var(--line);border-radius:10px;padding:8px 10px}
    .sliderRow>div{flex:1}

    /* enhanced range visuals: track uses --percent for filled area */
    .slider-wrap input[type="range"]{height:12px;background:linear-gradient(90deg,var(--accent) var(--percent,50%), #0d0f14 0);border-radius:10px;border:1px solid var(--line);-webkit-appearance:none;appearance:none}
    .slider-wrap input[type="range"]::-webkit-slider-runnable-track{height:10px;border-radius:8px;background:transparent;border:none}
    .slider-wrap input[type="range"]::-webkit-slider-thumb{margin-top:-9px;width:28px;height:28px;border-radius:14px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:2px solid #0b0c10;box-shadow:0 6px 18px rgba(142,160,255,.12);-webkit-appearance:none}
    .slider-wrap input[type="range"]::-moz-range-track{background:transparent;height:10px;border-radius:8px;border:none}
    .slider-wrap input[type="range"]::-moz-range-thumb{width:28px;height:28px;border-radius:14px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:2px solid #0b0c10;box-shadow:0 6px 18px rgba(142,160,255,.12)}
    .slider-wrap input[type="range"]:focus{outline:none;box-shadow:0 0 0 6px rgba(142,160,255,0.06)}

    /* Checkbox styling (robust across browsers) */
    input[type="checkbox"]{appearance:none;width:18px;height:18px;border:2px solid var(--line);border-radius:4px;background:#0d0f14;display:inline-grid;place-items:center;cursor:pointer;transition:border-color .2s, background .2s}
    input[type="checkbox"]:hover{border-color:var(--accent)}
    input[type="checkbox"]:checked{background:linear-gradient(180deg,var(--accent),#7382ff);border-color:var(--accent)}
    input[type="checkbox"]:checked::after{content:'\2713';color:#0b0c10;font-size:14px;font-weight:800;line-height:1}

    input[type="range"]{height:12px;background:transparent}
    input[type="range"]::-webkit-slider-runnable-track{height:10px;border-radius:8px;background:#0d0f14;border:1px solid var(--line)}
    input[type="range"]::-webkit-slider-thumb{margin-top:-7px;width:22px;height:22px;border-radius:11px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:1px solid #7382ff;box-shadow:0 2px 10px rgba(154,166,255,.35)}
    input[type="range"]::-moz-range-track{height:10px;border-radius:8px;background:#0d0f14;border:1px solid var(--line)}
    input[type="range"]::-moz-range-thumb{width:20px;height:20px;border-radius:11px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:1px solid #7382ff;box-shadow:0 2px 10px rgba(154,166,255,.35)}

    /* Improved, responsive slider styling */
    .sliderRow input[type="range"]{width:100%;height:12px;padding:0;background:linear-gradient(90deg,var(--accent) var(--percent,50%), #0d0f14 0);border-radius:8px;border:1px solid var(--line);-webkit-appearance:none;appearance:none}
    /* thicker track on desktop */
    @media (min-width:641px){.sliderRow input[type="range"]{height:12px}}
    /* larger thumb hit area for touch devices while keeping visual size */
    .sliderRow input[type="range"]::-webkit-slider-thumb{width:28px;height:28px;margin-top:-8px;border-radius:14px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:1px solid #7382ff;box-shadow:0 4px 14px rgba(142,160,255,.16)}
    .sliderRow input[type="range"]::-moz-range-thumb{width:28px;height:28px;border-radius:14px;background:linear-gradient(180deg,#8ea0ff,#7382ff);border:1px solid #7382ff;box-shadow:0 4px 14px rgba(142,160,255,.16)}
    .sliderRow input[type="range"]:focus{outline:none;box-shadow:0 0 0 4px rgba(142,160,255,0.08)}
    /* prevent accidental page scroll when dragging */
    .sliderRow input[type="range"]::-webkit-slider-runnable-track{cursor:pointer}

    .hint{color:var(--muted);font-size:13px}
    /* Strength meter styled as a thin accent bar */
    .box .meter{height:8px;border-radius:8px;background:#0d0f14;border:1px solid var(--line);overflow:hidden;margin:8px 0 12px}
    .meter>span{display:block;height:100%;width:0;transition:width .25s ease;background:var(--ok)}

    .kbd{font:700 12px/1 ui-monospace,monospace;background:#0d0f14;border:1px solid var(--line);border-radius:8px;padding:2px 6px;color:var(--ink)}
    footer{margin-top:16px;color:var(--muted);font-size:12px;text-align:center}

    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(154,166,255,.35)}100%{box-shadow:0 0 0 12px rgba(154,166,255,0)}}
    .pulse{animation:pulse .6s ease-out}
    .wiggle{animation:wig .18s ease-in-out}
    @keyframes wig{0%,100%{transform:translateX(0)}25%{transform:translateX(-2px)}75%{transform:translateX(2px)}}

    @media (prefers-reduced-motion: reduce){.btn,.pwd,.meter>span{transition:none}.pulse,.wiggle{animation:none}.toast{transition:none;transform:none}}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    @media (max-width:640px){.out{flex-direction:column;align-items:stretch}.btn:not(.icon){width:100%}.row{flex-wrap:wrap}.row input[type="range"]{width:100%}
      /* Ensure the card aligns from the top on narrow viewports to avoid clipping the header */
      body{align-items:flex-start;padding-top:20px}
    }
    /* Increase spacing for the two hint lines in the Strength/Entropy box */
    .grid > .box:nth-child(2) .hint{line-height:1.75;margin-top:10px}
  </style>
</head>
<body>
<div class="page">
  <div class="container">
    <main class="wrap card">
      <header>
        <h1>PassGen <span>idkwhy.top</span></h1>
        <p class="sub">Ultra‑light. Zero dependency. <b>Crypto‑grade randomness</b>. Offline‑ready. No frameworks. No tracking.</p>
      </header>

      <section class="out" aria-live="polite">
        <div id="pwd" class="pwd" tabindex="0" role="textbox" aria-label="Generated password" spellcheck="false"></div>
        <button id="regen" class="btn icon primary" title="Generate (Ctrl/⌘+Enter)" aria-label="Generate">
          <!-- refresh icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0114.13-3.36L23 10"></path><path d="M20.49 15a9 9 0 01-14.13 3.36L1 14"></path></svg>
        </button>
        <button id="copy" class="btn icon" title="Copy (Ctrl/⌘+C)" aria-label="Copy">
          <!-- clipboard icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1"></rect></svg>
        </button>
      </section>

      <section class="grid" aria-label="Options">
        <div class="box">
          <div class="row">
            <label for="len">Length</label>
            <output id="lenv" class="slider-value" for="len">16</output>
          </div>
          <div class="row sliderRow">
            <div>
              <div class="slider-wrap">
                <input id="len" type="range" min="8" max="64" value="16" aria-label="Password length">
              </div>
            </div>
          </div>
          <div class="row"><label><input id="lower" type="checkbox" checked> Lowercase a–z</label></div>
          <div class="row"><label><input id="upper" type="checkbox" checked> Uppercase A–Z</label></div>
          <div class="row"><label><input id="digits" type="checkbox" checked> Digits 0–9</label></div>
          <div class="row"><label><input id="symbols" type="checkbox"> Symbols !@#…</label></div>
          <div class="row"><label><input id="no-amb" type="checkbox" checked> Exclude ambiguous (O0 l1 I |)</label></div>
          <div class="row"><label><input id="pronounce" type="checkbox"> Pronounceable chunks (CV)</label></div>
        </div>
        <div class="box">
          <div class="row"><div>Strength / Estimated entropy</div><div id="entropy">—</div></div>
          <div class="meter" aria-hidden="true"><span id="bar"></span></div>
          <div class="hint">Shortcuts: <span class="kbd">Ctrl / ⌘</span> + <span class="kbd">Enter</span> to generate; <span class="kbd">Ctrl / ⌘</span> + <span class="kbd">C</span> to copy.</div>
          <div class="hint">Everything runs locally in your browser. Use a password manager to store results.</div>
        </div>
      </section>

      <footer>© <span id="y"></span> idkwhy.top · No tracking · No external links · Offline‑ready</footer>
    </main>
  </div>
</div>

<!-- toast element (screen-top slide-in) -->
<div id="toast" class="toast" aria-hidden="true" role="status"></div>

<script>
  'use strict';
  window.addEventListener('DOMContentLoaded', () => {
    const $ = (s) => document.querySelector(s);
    const pools = {
      lower: 'abcdefghijklmnopqrstuvwxyz',
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      digits: '0123456789',
      symbols: '!@#$%^&*()-_=+[]{};:,./?~' + "'\"`|\\",
    };
    const ambiguous = /[O0Il\|]/g;

    function pickFrom(str){
      const idx = crypto.getRandomValues(new Uint32Array(1))[0] % str.length;
      return str.charAt(idx);
    }
    function shuffle(arr){
      for(let i = arr.length - 1; i > 0; i--){
        const j = crypto.getRandomValues(new Uint32Array(1))[0] % (i + 1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function genPassword(cfg){
      let pool = '';
      if(cfg.lower) pool += pools.lower;
      if(cfg.upper) pool += pools.upper;
      if(cfg.digits) pool += pools.digits;
      if(cfg.symbols) pool += pools.symbols;
      if(cfg.noAmb) pool = pool.replace(ambiguous, '');
      if(!pool) pool = pools.lower;

      let chars = [];
      if(cfg.pronounce && !cfg.symbols && (cfg.lower || cfg.upper)){
        const C = 'bcdfghjklmnpqrstvwxyz';
        const V = 'aeiou';
        for(let i=0;i<Math.min(Math.max(6,cfg.len),20);i++){
          const set = (i%2===0)?C:V; chars.push(pickFrom(set));
        }
      }
      if(cfg.lower) chars.push(pickFrom(cfg.noAmb ? pools.lower.replace(ambiguous,'') : pools.lower));
      if(cfg.upper) chars.push(pickFrom(cfg.noAmb ? pools.upper.replace(ambiguous,'') : pools.upper));
      if(cfg.digits) chars.push(pickFrom(cfg.noAmb ? pools.digits.replace(ambiguous,'') : pools.digits));
      if(cfg.symbols) chars.push(pickFrom(cfg.noAmb ? pools.symbols.replace(ambiguous,'') : pools.symbols));

      while(chars.length < cfg.len){ chars.push(pickFrom(pool)); }
      chars = shuffle(chars).slice(0, cfg.len);

      const pwd = chars.join('');
      const N = Math.max(1, new Set(pool).size);
      const entropy = cfg.len * Math.log2(N);
      return { pwd, entropy };
    }

    function microPulse(sel){ const el=$(sel); if(!el) return; el.classList.remove('pulse'); void el.offsetWidth; el.classList.add('pulse'); }
    function microWiggle(sel){ const el=$(sel); if(!el) return; el.classList.remove('wiggle'); void el.offsetWidth; el.classList.add('wiggle'); }

    function readConfig(){
      return {
        len: +$('#len').value,
        lower: $('#lower').checked,
        upper: $('#upper').checked,
        digits: $('#digits').checked,
        symbols: $('#symbols').checked,
        noAmb: $('#no-amb').checked,
        pronounce: $('#pronounce').checked,
      };
    }

    function render(out){
      const box = $('#pwd');
      box.textContent = out.pwd;
      box.setAttribute('title', out.pwd);
      $('#entropy').textContent = `${out.entropy.toFixed(1)} bits`;
      const e = out.entropy;
      const w = Math.max(0, Math.min(100, (e/128)*100));
      const bar = $('#bar');
      bar.style.width = w + '%';
      bar.style.background = e<50? 'var(--bad)' : e<80? 'var(--warn)' : 'var(--ok)';
      // 注意：不在这里触发 pulse，改由调用者决定何时展示特效
    }

    function generate(manual=false){
      const cfg = readConfig();
      $('#lenv').textContent = cfg.len;
      const out = genPassword(cfg);
      render(out);
      if(manual){ microPulse('#pwd'); microPulse('#bar'); }
    }

    async function copy(){
      const text = $('#pwd').textContent || '';
      if(!text){ microWiggle('#pwd'); return; }
      try {
        await navigator.clipboard.writeText(text);
        showToast('Copied');
      } catch(err){
        const area = document.createElement('textarea');
        area.value = text; area.style.position='fixed'; area.style.opacity='0';
        document.body.appendChild(area); area.select();
        try{ document.execCommand('copy'); showToast('Copied'); }catch(_){ showToast('Unable to copy'); }
        document.body.removeChild(area);
      }
    }

    function showToast(msg){
      const t = document.getElementById('toast'); if(!t) return;
      t.textContent = msg; t.setAttribute('aria-hidden','false');
      t.classList.remove('hide'); t.classList.add('show');
      if(t._toastTimer) clearTimeout(t._toastTimer);
      t._toastTimer = setTimeout(()=>{
        t.classList.remove('show'); t.classList.add('hide');
        setTimeout(()=>{ t.setAttribute('aria-hidden','true'); t.classList.remove('hide'); }, 420);
      }, 1400);
    }

    // Update slider fill using CSS variable
    function updateRangeFill(el){
      if(!el) el = $('#len');
      const min = +el.min || 0, max = +el.max || 100, val = +el.value;
      const pct = Math.round((val - min) / (max - min) * 100);
      el.style.setProperty('--percent', pct + '%');
    }

    // Bind events
    $('#regen').addEventListener('click', ()=>generate(true));
    $('#copy').addEventListener('click', copy);
    // range: update fill then generate
    $('#len').addEventListener('input', (e)=>{ updateRangeFill(e.target); generate(); });
    for(const id of ['lower','upper','digits','symbols','no-amb','pronounce']){
      $('#' + id).addEventListener('change', generate);
    }
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); generate(true); }
      if((e.ctrlKey||e.metaKey) && (e.key==='c' || e.key==='C')){ e.preventDefault(); copy(); }
    });

    // Console smoke tests
    (function(){
      const only = (cfg) => genPassword(cfg).pwd;
      const digits = '0123456789';
      const symbols = "!@#$%^&*()-_=+[]{};:,./?~'\"`|\\";
      const ambRx = /[O0Il\|]/;
    })();

    // Init
    document.getElementById('y').textContent = new Date().getFullYear();
    // ensure slider fill matches initial value
    updateRangeFill(document.getElementById('len'));
    generate();
  });
  </script>
</body>
</html>
